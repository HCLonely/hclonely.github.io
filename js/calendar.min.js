!function(t){t.fn.aCalendar=function(e,a){return this.each((function(){return function(e,a,n){var r,l=new Date,s=l.getDate(),o=l.getMonth(),p=l.getFullYear(),u=s,d=o,i=p,c=n,f=null,h=null,y={posts:[],prev:null,next:null},g="en";(r=e)&&"undefined"!=typeof calLanguages&&calLanguages[r]&&(g=r);var v=t.extend({},t.fn.aCalendar.defaults,"undefined"==typeof calLanguages?{}:calLanguages[g],a);function m(){d<11?d++:(d=0,i++),T()}function M(){0<d?d--:(d=11,i--),T()}function x(t){t&&(i=t.getFullYear(),d=t.getMonth(),T())}function D(){v.single?null!=v.url&&""!=v.url&&(null===f&&t.ajax({url:v.url,async:!1,success:function(t){f=t,k(Object.keys(f))}}),null!==f&&w()&&(y.posts=f[i+"-"+(d+1)])):(null===h&&t.ajax({url:v.root+"list.json",async:!1,success:function(t){k(t)}}),w()&&t.ajax({url:v.root+i+"-"+(d+1)+".json",async:!1,success:function(t){y.posts=t}}))}function k(t){h=t.map((function(t){var e=t.split("-");return new Date(Date.UTC(+e[0],e[1]-1))}))}function w(){var t=Date.UTC(i,d);if(null!==h&&0!==h.length&&(0!==y.posts.length||!(null===y.prev&&null!==y.next&&y.next.getTime()>t||null===y.next&&null!==y.prev&&y.prev.getTime()<t))){y.posts=[];for(var e=0;e<h.length;e++){var a=h[e].getTime();if(t===a)return y.prev=0===e?null:h[e-1],y.next=e===h.length-1?null:h[e+1],1;if(t<a){y.prev=0===e?null:h[e-1],y.next=h[e];break}y.prev=h[e],y.next=null}}}function C(t,e){var a={"LMM+":v.months[t.getMonth()],"MM+":t.getMonth()+1};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,"LMM+"===n?a[n]:("00"+a[n]).substr((""+a[n]).length)));return e}function T(){D();var e=new Date(i,d,1).getDay()-v.weekOffset;e<=0&&(e=6- -1*(e+1));var a=new Date(i,d+1,0).getDate(),n=new Date(i,d,0).getDate()-e+1,r=t("<div/>").addClass("cal-head"),l=t("<div/>"),s=t("<div/>"),f=t("<div/>").addClass("cal-title");s.html(v.headArrows.previous),l.html(v.headArrows.next),curDate=new Date(Date.UTC(i,d)),0===y.posts.length?f.html(C(curDate,v.titleFormat)):(cTitleLink=t("<a/>").attr("href",C(curDate,v.titleLinkFormat)).attr("title",C(curDate,v.postsMonthTip)).html(C(curDate,v.titleFormat)),f.html(cTitleLink)),s.on("click",M),l.on("click",m),r.append(s),r.append(f),r.append(l);for(var h=t("<table/>").addClass("cal"),g=v.weekOffset,k=t("<thead/>"),w=t("<tr/>"),T=0;T<7;T++){6<g&&(g=0);var b=t("<th/>").attr("scope","col").attr("title",v.dayOfWeek[g]);b.html(v.dayOfWeekShort[g]),w.append(b),g++}k.append(w),h.append(k);var L=t("<tfoot/>"),F=t("<tr/>"),O=t("<td/>").attr("colspan",3),j=t("<td/>").html("&nbsp;"),A=t("<td/>").attr("colspan",3);y.prev&&O.html(v.footArrows.previous+v.months[y.prev.getMonth()]).addClass("cal-foot").attr("title",C(y.prev,v.postsMonthTip)),y.next&&A.html(v.months[y.next.getMonth()]+v.footArrows.next).addClass("cal-foot").attr("title",C(y.next,v.postsMonthTip)),O.on("click",(function(){x(y.prev)})),A.on("click",(function(){x(y.next)})),F.append(O),F.append(j),F.append(A),L.append(F);var S=t("<tbody/>"),W=1,E=1;for(T=0;T<6;T++){for(var R=t("<tr/>"),J=0;J<7;J++){var U=t("<td/>");if(7*T+J<e)U.addClass("cal-gray"),U.html(n++);else if(W<=a){W==u&&o==d&&p==i&&U.addClass("cal-today");for(var Y={num:0,keys:[]},$=0;$<y.posts.length;$++)new Date(Date.parse(y.posts[$].date)).getDate()==W&&(Y.keys[Y.num++]=$);if(0!==Y.num){var N=Y.keys[0],z=t("<a>").attr("href",y.posts[N].link).attr("title",y.posts[N].title).html(W++);U.append(z)}else U.html(W++)}else U.addClass("cal-gray"),U.html(E++);R.append(U)}S.append(R)}h.append(k),h.append(L),h.append(S),t(c).html(r),t(c).append(h)}return"/"!==v.root[0]&&(v.root="/"+v.root),"/"!==v.root[v.root.length-1]&&(v.root+="/"),T()}(e,a,t(this))}))},t.fn.aCalendar.defaults={months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["S","M","T","W","T","F","S"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],postsMonthTip:"Posts published in LMM yyyy",titleFormat:"yyyy LMM",titleLinkFormat:"/archives/yyyy/MM/",headArrows:{previous:'<span class="cal-prev"></span>',next:'<span class="cal-next"></span>'},footArrows:{previous:"« ",next:" »"},weekOffset:0,single:!0,root:"/calendar/",url:"/calendar.json"},t(document).ready((function(){t("#calendar").aCalendar("zh-CN")}))}(jQuery);